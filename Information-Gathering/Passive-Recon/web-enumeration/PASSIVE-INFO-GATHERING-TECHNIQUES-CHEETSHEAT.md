# <a id="top-of-page"></a> Passive Information Gathering

### Links

- [Passive Information Gathering](#p-info-gathering)
  - [WHOIS](#whois)
  - [DNS](#dns)
    - Nslookup & DIG
    - DNSRecon
    - DNS Repos
  - [OSINT](#osint)
    - Key Search Operators
    - Google Dorking
  - [HTTP Cipher Suites & Versions](#http)
    - Nmap NSE
    - TestSSL
    - Qualys SSL Labs
  - [Passive Domain/Subdomain Enumeration](#pass-domain-enum)
    - VirusTotal
    - Certificates
      - Censys
      - Crt.sh
    - TheHarvester
    - Spiderfoot
    - Shodan
  - [Passive Infrastructure Identification](#pass-infra-id)
    - Netcraft
    - Wayback Machine

# <a id="p-info-gathering"></a> Passive Information Gathering

## <a id="whois"></a> -WHOIS-

WHOIS is the "white pages" for domain names. The protocol is defined in RFC 3912 and the Internet Coporation of Assigned Names and Numbers (ICANN) requires newly registered domains to enter information into the WHOIS DB.

WHOIS is a CLI-based tool, but there are a lot of online version like [whois.domaintools.com](https://whois.domaintools.com/).

| **Command**                  | **Description**                           |
| ---------------------------- | ----------------------------------------- |
| `export TARGET="domain.tld"` | Assign target to an environment variable. |
| `whois $TARGET`              | WHOIS lookup for the target.              |

</br>

## <a id="dns"></a> -DNS-

| **Name**                 | **Description**                                                                                                                                                                                                                                                      |
| ------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Resource Record          | A domain name, usually a fully qualified domain name, is the first part of a Resource Record. If you don't use a fully qualified domain name, the zone's name where the record is located will be appended to the end of the name.                                   |
| TTL                      | In seconds, the Time-To-Live (TTL) defaults to the minimum value specified in the SOA record. wordlist                                                                                                                                                               |
| Record Class             | Internet, Hesiod, or Chaos login                                                                                                                                                                                                                                     |
| Start of Authority (SOA) | It should be first in a zone file because it indicates the start of a zone. Each zone can only have one SOA record, and additionally, it contains the zone's values, such as a serial number and multiple expiration timeouts.                                       |
| Name Servers (NS)        | The distributed database is bound together by NS Records. They are in charge of a zone's authoritative name server and the authority for a child zone to a name server.                                                                                              |
| IPv4 Addresses (A)       | The A record is only a mapping between a hostname and an IP address. 'Forward' zones are those with A records.                                                                                                                                                       |
| Pointer (PTR)            | The PTR record is a mapping between an IP address and a hostname. 'Reverse' zones are those that have PTR records.                                                                                                                                                   |
| Canonical Name (CNAME)   | An alias hostname is mapped to an A record hostname using the CNAME record.                                                                                                                                                                                          |
| Mail Exchange (MX)       | The MX record identifies a host that will accept emails for a specific host. A priority value has been assigned to the specified host. Multiple MX records can exist on the same host, and a prioritized list is made consisting of the records for a specific host. |
| Nameserver               | Stores and organizes DNS records, each of which pairs a domain with one or more IP addresses                                                                                                                                                                         |

### --Nslookup--

| **Command**                    | **Description**                 |
| ------------------------------ | ------------------------------- |
| `nslookup <TARGET>`            | Query A record                  |
| `nslookup -query=ANY <TARGET>` | Query a specific type of record |
| `nslookup -port=123 <TARGET>`  | Specify the port number         |

### --DIG--

| **Command**                   | **Description**                                         |
| ----------------------------- | ------------------------------------------------------- |
| `dig <TARGET>`                | Query A record                                          |
| `dig <TARGET> @1.1.1.1`       | Query A record with nameserver defined @<nameserver/IP> |
| `dig a www.<TARGET> @1.1.1.1` | Query A records for subdomain                           |
| `dig -x 31.13.92.36 @1.1.1.1` | Query PTR records for IP address                        |
| `dig any <TARGET>`            | Query ANY records for domain (may not recieve response) |

### --DNSRecon--

[DNSRecon](https://github.com/darkoperator/dnsrecon) is a script that can perform many DNS reconnaissance function. The functionality includes:

- Check all NS records
- Enum general DNS records for a given domain
- Perform common SRV record enum
- TLD expansion
- Check for wildcard resolution
- Brute-force subdomain and host A/AAAA and CNAME records
- Perform PTR lookup for IP range or CIDR
- Check a DNS Server cache for A/AAAA & CNAME records
- Enum common mDNS records in local network
- Enum hosts and subdomains using Google

| **Command**               | **Description** |
| ------------------------- | --------------- |
| `dnsrecon.py -d <domain>` | Basic usage     |

### --DNS Repos--

A couple online services exist that collect DNS data and make it publicly available for research.

- [DNSDumpster](https://dnsdumpster.com/)
- [Farsight's Security's DNSDB](https://www.domaintools.com/)

## <a id="osint"></a> -OSINT-

### --Key Search Operators--

**---Google Search Engine---**

| **Search Operator**                 | **Description**                                      |
| ----------------------------------- | ---------------------------------------------------- |
| `-`                                 | Exclude elements                                     |
| `"TEXT"`                            | Exact match                                          |
| `site:xyz.com`                      | Filter to only particular site                       |
| `cache:xyz.com`                     | Search the cache rathen than live index              |
| `ext:pdf` \|\| filetype:pdf         | Filter to only match files of certain type/extension |
| `intitle:"TEXT" \|\| inurl: "TEXT"` | Search the web page for text in url or in title      |

**---DuckDuckGo---**

| **Command** | **Description**                                                         |
| ----------- | ----------------------------------------------------------------------- |
| `!`         | Followed by one of the 10k providers allows searching directly from DDG |

**---Bing---**

| **Command**         | **Description**                                                                       |
| ------------------- | ------------------------------------------------------------------------------------- |
| `ip:1.1.1.1`        | Search for specific IP                                                                |
| `prefer: "TEXT"`    | Emphasizes the preferred item in search results                                       |
| `url:TEXT`          | Check the address in Bing index                                                       |
| `STEXTnear:10ETEXT` | The first word must be within 10 words of the last word                               |
| `contains:asp`      | Returns sites with links to specified type, does not return links to files themselves |

### --Google Dorking--

Google Dorking involves using advanced search operations in Google to search for specific keywords, file types, or website parameters. These operators can be combined to create more powerful search queries that can reveal information that would not be easily accessible otherwise.

- [Google Hacking Database](https://www.exploit-db.com/google-hacking-database)

</br>

## <a id="http"></a> -HTTP Cipher Suites & Versions-

Testing for weak Transport Layer Security should be done to check if cryptography attacks can be conducted.

### --Nmap NSE--

Nmap has the 'ssl-enum-ciphers' script that will evaluate and categorize cipher strengths with grades of A-F.

| **Command**                               | **Description**                  |
| ----------------------------------------- | -------------------------------- |
| `nmap --script=ssl-enum-ciphers <TARGET>` | Check a targets cipher strengths |

### --TestSSL--

TestSSL is a tool that will scan and report on HTTPS configuration and does NOT rely on OpenSSL to perform the analysis.

| **Command**             | **Description**                  |
| ----------------------- | -------------------------------- |
| `./testssl.sh <TARGET>` | Check a targets cipher strengths |

### --Qualys SSL Labs--

A public resource for evaluating SSL configs. It is free and publicly accessible and does not require registration.

- [Qualys SSL Labs](https://www.ssllabs.com/)

## <a id="pass-domain-enum"></a> -Passive Domain/Subdomain Enumeration-

Subdomain enumeration refers to mapping all available subdomains within a domain name. It increases the attack surface and may uncover hidden management backend panels or intranet web applications that network administrators expected to keep hidden using the "security by obscurity" strategy.

### --VirusTotal--

[VirusTotal](https://www.virustotal.com/) maintains its DNS replication service, which is developed by preserving DNS resolutions made when users visit URLs given by them. To receive information about a domain, type the domain name into the search bar and click on the "Relations" tab.

### --Certificates--

Another interesting source of information that can be used to extract subdomains is SSL/TLS certificates. The main reason is Certificate Transparency (CT), a project that requires every SSL/TLS certificate issued by a Certificate Authority (CA) to be published in a publicly accessible log.

**_'Manual' Tools_**

- [Censys](https://censys.io)
- [crt.sh](https://crt.sh)

Additionally the results from these sites can be pulled down to the CLI for better analysis.

| **Command**                                                                                                                                 | **Description**                                        |
| ------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------ |
| `export TARGET="<TARGET>.com"`                                                                                                              | Set nix env var                                        |
| `curl -s "https://crt.sh/?q=${TARGET}&output=json" \| jq -r '.[] \| "\(.name_value)\n\(.common_name)"' \| sort -u > "${TARGET}_crt.sh.txt"` | Pull down JSON output and filter sort for domain names |

Alternative method using OpenSSL.

| **Command**                                                                                                                                                                                                             | **Description**                         |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------- |
| `export TARGET="<TARGET>.com"`                                                                                                                                                                                          | set nix env var                         |
| `export TARGET="<TARGET>.com"`                                                                                                                                                                                          | set nix env var                         |
| `openssl s_client -ign_eof 2>/dev/null <<<$'HEAD / HTTP/1.0\r\n\r' -connect "${TARGET}:${PORT}" \| openssl x509 -noout -text -in - \| grep 'DNS' \| sed -e 's\|DNS:\|\n\|g' -e 's\|^\*.*\|\|g' \| tr -d ',' \| sort -u` | Use OpenSSL to get the Certificate info |

**_Automated Tools_**

### --TheHarvester--

TheHarvester is a simple-to-use yet powerful and effective tool for early-stage penetration testing and red team engagements. It can be used to gather information to help identify a target's attack surface. The tool collects emails, names, subdomains, IP addresses, and URLs from various public data sources for passive information gathering.

- [TheHarvester](https://github.com/laramies/theHarvester)

TheHarvester uses 'modules' to perform the passive information gathering. An example of some of these modules is below:

| **Name**  | **Description**                                          |
| --------- | -------------------------------------------------------- |
| Baidu     | Baidu search engine.                                     |
| Crtsh     | Comodo Certificate search.                               |
| Sublist3r | Fast subdomains enumeration tool for penetration testers |

To use these modules with TheHarvester a file will need to be create 'example.txt' with the names of the wanted modules in each row.

| **Command**                                                                                                                                                 | **Description**                                            |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------- |
| `export TARGET="<TARGET>.com"`                                                                                                                              | Set nix env var                                            |
| `cat example.txt \| while read source; do theHarvester -d "${TARGET}" -b $source -f "${source}_${TARGET}";done`                                             | Run the target by all of the modules that are selected     |
| `cat *.json \| jq -r '.hosts[]' 2>/dev/null \| cut -d':' -f 1 \| sort -u > "${TARGET}_theHarvester.txt"`                                                    | Wait till the process finishes and then extract subdomains |
| `cat target\_\*.txt                                                                                             \| sort -u > target_subdomains_passive.txt` | Merge all passive recon files together                     |

### --Spiderfoot--

[Spiderfoot](https://github.com/smicallef/spiderfoot) is a comprehensive open-source OSINT suite that follow both rapid and comprehensive analysis of a given target starting (IP, domain name, etc...). Some aspects may require an API key or subscription.

### --Shodan--

[Shodan](https://www.shodan.io/) is a IoT search engine that can also serve as a port scanner. Can possible reveal systems related to the target that were otherwise hidden.

</br>

## <a id="pass-infra-id"></a> -Passive Infrastructure Identification-

### --Netcraft--

[Netcraft](https://www.netcraft.com/) can offer information about the servers without even interacting with them, and this is something valuable from a passive information gathering point of view. This can be used by visiting https://sitereport.netcraft.com and entering the target domain.

Interesting Details from the report:

| **Name**        | **Description**                                                  |
| --------------- | ---------------------------------------------------------------- |
| Background      | General info about the domain, including the date is was seen    |
| Network         | Info about the netblock owner, hosting company, nameservers, etc |
| Hosting history | Lastest IPs used, webserver, and target OS                       |

### --Wayback Machine--

The Internet Archive is an American digital library that provides free public access to digitalized materials, including websites, collected automatically via its web crawlers.

Website version of [Wayback Machine](http://web.archive.org/).

There is also a tool [waybackurls](https://github.com/tomnomnom/waybackurls) that can be used to query Wayback Machine.

| **Command**                                                 | **Description**                     |
| ----------------------------------------------------------- | ----------------------------------- |
| `go install github.com/tomnomnom/waybackurls@latest`        | Install the modules for the go code |
| `waybackurls -dates https://<TARGET>.com > waybackurls.txt` | Query a specific type of record     |

[Back to top](#top-of-page)
